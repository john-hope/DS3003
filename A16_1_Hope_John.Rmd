---
title: "Assignment 16 - Animations (4 pts)"
author: "Group 1, John Hope (jah9kqn)"
date: "Due Date: 11:59pm, Apr 10"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_float: yes
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
library(tidyverse)
library(gifski)
library(png)
library(shiny)
library(shinythemes)
library(gganimate)
library(plotly)
```

# Part 1: `gganimate`

```{r}
# Read in the data
covid<-read.csv("owid-covid-data.csv")

# Choose countries to use
countries <- c("United States","China","Japan","Italy","France","Russia")

# Filter for those countries
covid_filter <- covid %>% filter(location %in% countries)

# Convert date column to date objects
covid_filter$date <- as.Date(covid_filter$date)

# Create plot
covid_per_capita_fig <- ggplot(data = covid_filter,
                               mapping=aes(x=date, y=100000*new_deaths_smoothed/population,
                                           color=location, linetype=continent, group=location)) +
  geom_line() + theme_bw() + 
  theme(legend.position="top", legend.title=element_blank(), legend.direction="horizontal",
        legend.box="vertical") +
  labs(title="Covid Deaths Each Day Per 100,000 People in Countries", x="Date", y="Mortality rate")

# Animate the plot
covid_per_capita_fig + geom_point() + transition_reveal(date)
```

Looking at the plot what we see is 3 large spikes in mortality rate. What is interesting is that each country seems to spike at different times. We first see Italy and France spike quickly but fall but down followed by another spike with the US included this time. On the last spike we see a big increase in the mortality rate in Russia.

# Part 2: `plotly`

Link: https://www.kaggle.com/datasets/neuromusic/avocado-prices 

The dataset we chose to use for this assignment is an avocado pricing dataset we found on kaggle. The data set contains information on total sales and pricing on avocados in the US from 2015 to 2018. Some important variables for us that we will be using in our plot are date, average sale price, region/location of the sale, total volume of avocados sold, and total number of bags sold. 
   
- Third, create any animated plot with the `Play` button.  

```{r}
# Read in data
avocado<-read.csv("avocado.csv")

# Select regions to use
regions<-c("New York","Tampa","RichmondNorfolk",
           "DallasFtWorth","LasVegas","Philadelphia",
           "Portland","Detroit","Chicago")

# Filter for those regions
avocado_subset<-avocado %>% filter(region%in%regions)

# Create plotly plot for sales and price over time
fig<-avocado_subset %>% plot_ly(x=~Total.Volume,
                         y=~AveragePrice,
                         size = ~Total.Bags,
    marker = list(sizeref=0.03),
    color=~region,
    frame = ~Date, 
    hoverinfo = 'text',
    type = 'scatter',
    mode = 'markers'
   )

# Labels
fig %>% layout(xaxis=list(title='Total Volume of Avocados Sold'), 
                yaxis=list(title='Average Price of the Avocados'),
               title="Total Avocados Sold Versus Average Sale Price")
```

What we see looking at this plot is that Dallas Ft Worth sells the most avocados from the subset of regions we chose to look at. Generally though they don't sell at a price, on average, as high as some of the other regions such as Chicago or Philadelphia. We also see a lot of variation in both price and total volume sold from week to week in all of the regions. This is made evident by the amount of movement when playing the animation. We also saw some spikes in price in middle to late 2017.