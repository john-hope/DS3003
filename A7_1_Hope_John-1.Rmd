---
title: "Assignment 7 - loess (4 pts)"
author: "Group 1, John Hope (jah9kqn)"
date: "Due Date: 11:59pm, Feb 20"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_float: yes
    code_folding: show
  pdf_document:
    toc: yes
---

```{=html}
<style>
h1.title {
  font-size: 30px;
}
h1 {
  font-size: 26px;
}
h2 {
  font-size: 22px;
}
h3 { 
  font-size: 18px;
}

</style>
```

# Group Homework 

- You will work with your group to complete this assignment.

- *Submit your group's shared `.Rmd` AND "knitted"`.html` files*
    
    +  Your "knitted .html" submission must be created from your "group .Rmd" but be created on your own computer
    
    + Confirm this with the following comment included in your submission text box: **"Honor Pledge: I have recreated my group submission using using the tools I have installed on my own computer"**
    
    + Name the files with a group name and YOUR name for your submission

*Each group member must be able to submit this assignment as created from their own computer. If only some members of the group submit the required files, those group members must additionally provide a supplemental explanation along with their submission as to why other students in their group have not completed this assignment.*


# Part 1 

- Use the SCS Data set you downloaded from Collab for Assignments 4 and 5, and then investigate the relationship between the mathematics achievement score (“mathpre”) and the math anxiety score (“mars”) by plotting the data and the path of means. 

- Don't use package `ggplot2` for Part 1. Use `ggplot2` for Part 2.

(1) Produce a scatterplot between “mathpre” and “mars” (you might consider using `jitter()` or `alpha()` for avoiding overlying points) and add a regression smoother using `loess()`. Compare the resulting plot to the plot you obtain by using `scatterplot()` from the `car`-package.
 
```{r, warning=FALSE, message=FALSE}
library(foreign)
scs<-read.spss("/Users/johnhope/Desktop/DS3003/Data/SCS_QE.sav",to.data.frame = TRUE)

x.val <- seq(0, 130, by = 1)
out.lss <- loess(mathpre ~ mars, data = scs, span = .30, degree = 0) 
y.pred <- predict(out.lss, data.frame(mars = x.val)) 
plot(mathpre ~ mars, data = scs, cex = .4, xlab = 'Math Anxiety Ranking', 
     ylab = 'Math PreTest Score', main = 'Local Regression')  
lines(x.val, y.pred, col = 'red', lwd = 2)

library(car)
scatterplot(mathpre ~ mars, data=scs, xlab = "Math Anxiety Ranking", ylab = "Math PreTest Score", 
  smooth=list(style="lines"))
```


(2) Draw separate regression smoothers for female and male students (variable “male”). Use `loess()`.

```{r, warning=FALSE, message=FALSE}
plot(mathpre ~ mars, data = scs, cex = .4, xlab = 'Math Anxiety Ranking', 
     ylab = 'Math PreTest Score', bty = 'L')  

out.m <- loess(mathpre ~ mars,scs, subset = male == 'male', 
         span = .95, degree = 2)
out.f <- loess(mathpre ~ mars, data = scs, subset = male == 'female', 
         span = .9, degree = 2)
x.val <- seq(0, 130, by = 1)

lines(x.val, predict(out.m,x.val), col = 'blue', lwd = 2)

lines(x.val, predict(out.f,x.val), col = 'red', lwd = 2) 
```


(3) Describe the roles of regression smoothers in finding a relationship between math scores and math anxiety. 

The regression smoothers over the scatterplot help us visualize the relationship between math scores and anxiety. Since the points on the plot are so spread out, it is hard to get a sense of trend without the regression smoother. Loess() calculates the mean within a window for each anxiety score ranking and is resistant to outliers, so it is a good estimation of the relationship. Based on the line, there is a small inverse relationship between math test scores and anxiety, meaning as anxiety rankings rose, test scores fell. When split up between males and females, the line for females definitely follows this trend as well. The line for males also follows this trend, but with a dip in math scores between the 40 and 60 points anxiety ranking, and leveling out beyond that.


# Part 2

- Re-do **Part 1** using package `ggplot2`. That is, 

(1) Produce a scatterplot (you might consider using `geom_jitter()` or the argument `alpha` from package `ggplot2` for avoiding overlying points) and add a regression smoother using `geom_smooth()`. 

```{r, warning=FALSE, message=FALSE}
library(ggplot2)
ggplot(scs, aes(x=mars, y=mathpre)) + geom_point() + labs(x = 'Math Anxiety Ranking', y = 'Math PreTest Score', title = "Math Anxiety vs Test Score") + geom_smooth(method='loess', formula= y~x, col="red", se = FALSE, span = 0.45)
```

(2) Draw separate regression smoothers for female and male students (variable “male”). Use package `ggplot2`.

```{r, warning=FALSE, message=FALSE}
ggplot(scs, aes(x=mars, y=mathpre, col=male)) + geom_point(alpha=0.4) + labs(x = 'Math Anxiety Ranking', y = 'Math PreTest Score', title = "Math Anxiety vs Test Score by Sex") + geom_smooth(method='loess', formula= y~x, se = FALSE, span = 0.9)
```


# Part 3

- Use a dataset in data repositories (e.g., [kaggle](https://www.kaggle.com/datasets)) that gives the measurements in different conditions like `iris` data. For more info on `iris` data, use `?iris`.

- Briefly describe the dataset you're using for this assignment (e.g., means to access data, context, sample, variables, etc...).

   + The following dataset is heart disease classification dataset. The dataset was accessed on Kaggle, and can be found [here](https://www.kaggle.com/ronitf/heart-disease-uci). The data contains 14 variables/columns, consisting of bodily measurements, like cholesterol, blood pressure, blood sugar levels and heart rate, as well as age and sex. The goal of use of the data is to determine presense of heart disease in patients. The "goal" variable is from a range of 0 to 4, 0 indicating no presense of heart disease, and 4 being the most. We want to understand which variables are most important in predicting whether or not patients have or are susceptible to heart disease The population here is a sample of nearly 2,000 patients who's data was used and stored across databases in the U.S.
   
- Transform the dataset from a wide to a long format. Produce any ggplot where the key variable is used in function `facet_grid` or `facet_wrap`.

```{r, warning=FALSE, message=FALSE}
library(tidyr)
library(ggplot2)

heart <- read.csv('/Users/johnhope/Desktop/DS3003/Data/heart.csv') # read in data
heart$sex <- ifelse(heart$sex==1,"Male","Female") # recoding 1,0 to male, female
heart <- heart[c(-3, -6, -7, -9, -10:-14)] # removing unneccesary columns (factors)

# Transform from wide to long with variables we want to look at
longheart <- gather(heart, key = patient_att, value = measurement, 
                    c(trestbps, chol, thalach, age))

# Boxplot with measurements classified by sex
ggplot(longheart, aes(x=sex, y=measurement)) + geom_boxplot() + 
   facet_grid(~ patient_att) + theme_bw()
```


