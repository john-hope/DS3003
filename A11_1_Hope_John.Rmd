---
title: "Assignment 11 - Shiny"
author: "Group 1, John Hope (jah9kqn)"
date: "Due Date: 11:59pm, Mar 27"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_float: yes
    code_folding: show
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
library(knitr)
library(tidyverse)
library(plotly)
library(foreign)
library(shiny)
library(rsconnect)
setwd('Users/johnhope/Desktop/DS3003/Data')
```

# Group Homework 

- You will work with your group to complete this assignment.

- Upload your Shiny app on [ShinyApps.io](https://www.shinyapps.io).

- Submit your group's shared `.Rmd` AND your URL (https://XXXXX.shinyapps.io/XXXXX) on Collab.

- Confirm this with the following comment included in your submission text box: **"Honor Pledge: I have recreated my group submission using using the tools I have installed on my own computer"**
    
- Name the files with a group name and YOUR name for your submission.

- One of the group members will **present R codes and plots for Parts 1 and 2** in class on **Mar. 28 (Mon)**. Please e-mail the instructor if you're a presenter by 11:59pm, Mar. 27. Also, if you're a presenter, please bring your laptop so that you can share your screen on zoom for the presentation.

# Part 1

- First, get the latest data from from [https://covid19.who.int/info?openIndex=2](https://covid19.who.int/info?openIndex=2).
      
   - The file should likely be named "WHO-COVID-19-global-table-data.csv"
      
   - Don't use the data for Group Assignment 10. It may not be the most recent data. 

- Create a subset including 3 countries per `WHO region` (Africa, Americas, Eastern Mediterranean, Europe, South-East Asia, Western Pacific). You can choose any three countries within each `WHO region` to compare the mortality rate (`mutate(rate = "Deaths - cumulative total"/"Cases - cumulative total")`). The selected countries can be the same as those for Group Assignment 10.

- Create a shiny app to produce bar plots (with error bars), along with the control type of `selectInput()`.

     - You need to use `selectInput()` in the `ui` to select one level from the `WHO region` variable (with 6 levels: Africa, Americas, Eastern Mediterranean, Europe, South-East Asia, Western Pacific). 
     
     - Your output should be a barplot of mortality rates with error bars from three countries in the selected region. 

- Example: https://youmi.shinyapps.io/A11examplePart1/

```{r}
covid<-read.csv("WHO-COVID-19-global-table-data.csv", header = TRUE)

covid<-covid %>% rename(Country=Name, deaths_cum_total=Deaths...cumulative.total, cases_cum_total=Cases...cumulative.total)

names(covid)[1:(ncol(covid)-1)] <- names(covid)[2:ncol(covid)]
covid[, ncol(covid)] <- NULL

covid <- cbind(Country = rownames(covid), covid)
rownames(covid) <- 1:nrow(covid)

covid_filter<- covid %>% 
  filter(Country %in% c("Algeria","Congo","Liberia","Mexico","Canada","United States of America","France","Germany","Italy","Nepal","India","Thailand","Australia","Republic of Korea","Singapore","Bahrain","Iraq","Libya")) %>%
  mutate(rate=round((deaths_cum_total)/(cases_cum_total),digits = 2),SE= sqrt(rate*(1-rate)/(cases_cum_total)))

shinyApp(
  ui = fluidPage(
  selectInput('WHO.Region', label = "WHO Region:",
              choices = c("Africa", "Americas", "Eastern Mediterranean", "Europe", "South-East Asia", "Western Pacific"), selected = "Americas"),
  plotOutput("whocovid")
  ),
  
  server = function(input, output){
    output$whocovid <- renderPlot({
      csubset<-covid_filter[which(covid_filter$WHO.Region==input$WHO.Region),] #all rows of the data with the subset of regions
      ggplot(csubset, aes(x=Country, y=rate)) + 
geom_bar(position=position_dodge(), stat="identity",
         colour="black") +     
labs(x="Country", y="Mortality Rate", title="COVID-19 Mortality Rate by Country Across Different Regions") +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))  +
geom_errorbar(aes(ymin=rate-1.96*SE, ymax=rate+1.96*SE), width=.2,
                 position=position_dodge(.9))
      })}
) 
```


# Part 2

- Use a dataset that is available in data repositories (e.g., [kaggle](https://www.kaggle.com/datasets)). But don't use the datasets you used for your previous assignments.

- Briefly describe the dataset you're using for this assignment (e.g., means to access data, context, sample, variables, etc...)
  
   + *describe your data.*
   
- Select *two* continuous variables (denoted as "A" and "B") 

- Create an interactive scatterplot between "A" and "B" with a loess line using Shiny app. Please refer to lecture notes `DS3003_localreg_loess_note.pdf`, `DS3003_localreg_loess_code.rmd`, and `DS3003_localreg_loess_code.html` 

- You need to create two input variables for loess regression. 

    - One input variable is the degree with values of 0, 1, and 2.
    - The other input variable is the span value ranging from 0.2 to 0.9.
   
- You can choose appropriate control types from [Widget gallery](https://shiny.rstudio.com/gallery/widget-gallery.html).
     
```{r}
happy <- read.csv("2019.csv")

inputPanel(
  sliderInput("span", label = "Span:",
              min = 0.2, max = 0.9, value = 0.5, step = 0.1),
  
  selectInput("degree", label = "Degree:",
              choices = seq(0, 2, 1), selected = 1)
)


renderPlot({
  ggplot(happy, aes(x=Happiness.Score, y=Health..Life.Expectancy.)) + 
    geom_point() + 
    geom_smooth(method="loess", formula=y~poly(x, as.numeric(input$degree)), se=FALSE, span=input$span) + 
    theme_bw()
})
```

- Describe a relationship between A and B. Also, describe how a loess line changes as the degree increases and/or the span value increases.

There is a very clear positive relationship between a country's happiness score and its life expectancy. Changing the degree changes the degree of polynomial of the loess line. When the degree equals 2, there seems to be some overfitting of the data, and degree 1 seems to give a simpler loess line that is just as accurate. When adjusting the span, a higher span will give a smoother line while a lower span will fit more accurately to the data. Since there is such an obvious positive relationship between happiness score and life expectancy, a high span such as 0.8 or 0.9 still follows the trend of the plot fairly well.
